<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org"
    xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{common/layouts/default_layout}"
    layout:fragment="content">
<head>
    <meta charset='utf-8' />
    
    <!-- FullCalendarì™€ Google Calendar í”ŒëŸ¬ê·¸ì¸ ì¶”ê°€ (CDN) -->
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@fullcalendar/google-calendar@6.1.8/index.global.min.js"></script>
    <script src="https://kit.fontawesome.com/a4d9e872af.js" crossorigin="anonymous"></script>
    <style>
    /* ê³µíœ´ì¼ ì´ë²¤íŠ¸ ë°°ê²½ ì œê±° ë° ê¸€ìë§Œ í‘œì‹œ */
    .gcal-event {
        background: none !important;
        border: none !important;
        color: black !important;
        font-size: 12px !important;
        font-weight: bold !important;
        display: block !important;
        padding: 0 !important;
        text-align: right !important;
        pointer-events: none !important;
    }

    /* FullCalendar ë‚´ë¶€ì˜ ì´ë²¤íŠ¸ ê¸€ìë§Œ ë‚¨ê¸°ê³  ë‹¤ë¥¸ ìŠ¤íƒ€ì¼ ì œê±° */
    .fc-event-main {
        white-space: nowrap !important;
        overflow: visible !important; /* ê¸€ìê°€ ìˆ¨ê²¨ì§€ëŠ” ë¬¸ì œ í•´ê²° */
    }

    /* í† ìš”ì¼ ë‚ ì§œ ìŠ¤íƒ€ì¼ (íŒŒë€ìƒ‰) */
    .fc-day-sat .fc-daygrid-day-number {
        color: blue !important;
    }

    /* ì¼ìš”ì¼ ë‚ ì§œ ìŠ¤íƒ€ì¼ (ë¹¨ê°„ìƒ‰) */
    .fc-day-sun .fc-daygrid-day-number {
        color: red !important;
    }

    #addScheduleBtn {
        display: block;
        margin-bottom: 10px;
        padding: 10px;
        background-color: #007bff;
        color: white;
        border: none;
        cursor: pointer;
    }
    
    .modal-header {
    	text-align: center;
    }
    .fa-square-full span {
    	color: black;
    }
    </style>
</head>
<body>

    <div class="form-group">
        <button id="addScheduleBtn">ì¼ì • ì¶”ê°€</button>
        	<i class="fa-solid fa-square-full" style="color: #00ff00;"><span>ê°œì¸ì¼ì •</span></i>
        	<i class="fa-solid fa-square-full" style="color: #0000ff;"><span>ë¶€ì„œì¼ì •</span></i>
        	<i class="fa-solid fa-square-full" style="color: #FFD43B;"><span>íšŒì‚¬ì¼ì •</span></i>
        <div id='calendar-container'>
            <div id="calendar"></div>
        </div>
    </div>

    <!-- ì¼ì • ë“±ë¡ ëª¨ë‹¬ -->
<div id="scheduleModal" class="modal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title w-100 text-center">ì¼ì • ì¶”ê°€</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
    <div class="d-flex align-items-center mb-2">
        <label class="col-sm-3">ì¼ì • ìœ í˜•:</label>
        <div class="form-check">
            <input type="radio" name="scheduleType" value="ê°œì¸" id="personal" class="form-check-input" checked>
            <label for="personal" class="form-check-label">ê°œì¸</label>
        </div>
        <div class="form-check">
            <input type="radio" name="scheduleType" value="ë¶€ì„œ" id="department" class="form-check-input">
            <label for="department" class="form-check-label">ë¶€ì„œ</label>
        </div>
        <div class="form-check">
            <input type="radio" name="scheduleType" value="íšŒì‚¬" id="company" class="form-check-input">
            <label for="company" class="form-check-label">íšŒì‚¬</label>
        </div>
    </div>
    <!-- ê³µìœ  ëŒ€ìƒì ì„ íƒ ì˜ì—­ (ê°œì¸ì¼ì •ì¼ ë•Œë§Œ ë³´ì„) -->
	<div class="form-group" id="shareTargetGroup" style="display: none;">
	  	<label>ê³µìœ  ëŒ€ìƒì</label>
		<button type="button" class="btn btn-sm btn-outline-primary" data-toggle="modal" data-target="#shareModal">ê³µìœ ì ì„ íƒ</button>
		<ul id="selectedShareList" class="list-group mt-2"></ul>
		<input type="hidden" id="sharedEmployeeNos">
	</div>
    <div class="d-flex align-items-center mb-2">
        <label class="col-sm-2">ì œëª©:</label>
        <input type="text" id="scheduleTitle" class="form-control w-100">
    </div>
    <div class="d-flex align-items-center mb-2">
        <label class="col-sm-2">ë‚´ìš©:</label>
        <textarea id="scheduleContent" class="form-control w-100" rows="5"></textarea>
    </div>
    <div class="d-flex align-items-center mb-2">
        <label class="col-sm-3">ì‹œì‘ì¼ì‹œ:</label>
        <input type="datetime-local" id="scheduleStart" class="form-control">
    </div>
    <div class="d-flex align-items-center mb-2">
        <label class="col-sm-3">ì¢…ë£Œì¼ì‹œ:</label>
        <input type="datetime-local" id="scheduleEnd" class="form-control">
    </div>
</div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" onclick="saveSchedule()">ì €ì¥</button>
        <button type="button" class="btn btn-secondary close2" data-dismiss="modal">ë‹«ê¸°</button>
      </div>
    </div>
  </div>
</div>


	
	<!-- ì¼ì • ìƒì„¸ ì •ë³´ ëª¨ë‹¬ -->
<div id="scheduleInfoModal" class="modal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">ì¼ì • ì œëª©</h5>
        <button type="button" class="close closeModal2" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <!-- ë™ì ìœ¼ë¡œ ì¼ì • ìƒì„¸ ì •ë³´ ì‚½ì… -->
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" onclick="updateSchedule()">ìˆ˜ì •</button>
    <button type="button" class="btn btn-danger" onclick="deleteSchedule()">ì‚­ì œ</button>
    <button type="button" class="btn btn-secondary closeModal" data-dismiss="modal">ë‹«ê¸°</button>
      </div>
    </div>
  </div>
</div>

<!-- ê³µìœ  ëŒ€ìƒì ì„ íƒ ëª¨ë‹¬ -->
<div class="modal fade" id="shareModal" tabindex="-1">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header"><h5>ê³µìœ  ëŒ€ìƒì ì„ íƒ</h5></div>
      <div class="modal-body">
        <input type="text" id="searchShare" class="form-control mb-2" placeholder="ğŸ” ê²€ìƒ‰">
        <ul id="orgTreeShare" class="list-unstyled"></ul>
      </div>
      <div class="modal-footer">
        <button class="btn btn-primary" id="addSharesBtn">ì¶”ê°€</button>
        <button class="btn btn-secondary" data-dismiss="modal">ë‹«ê¸°</button>
      </div>
    </div>
  </div>
</div>

<script>
    const url = '/schedule';
    document.addEventListener('DOMContentLoaded', function () {
        const calendarEl = document.getElementById('calendar');

        const calendar = new FullCalendar.Calendar(calendarEl, {
            locale: "ko",
            height: '550px',
            expandRows: true,
            slotMinTime: '09:00:00',
            slotMaxTime: '19:00:00',
            headerToolbar: {
                left: 'prevYear,prev,next,nextYear today',
                center: 'title',
                right: 'dayGridMonth,timeGridWeek,timeGridDay,listWeek'
            },
            initialView: 'dayGridMonth',
			
            
         // ì¼ì • ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            events: function (fetchInfo, successCallback, failureCallback) {
                fetch(url)
                    .then(response => response.json())
                    .then(data => {

                        // FullCalendarì—ì„œ ì¸ì‹í•  ìˆ˜ ìˆë„ë¡ ë°ì´í„° ë³€í™˜
                        let events = data.map(event => {
                            if (!event) {
                                console.warn("ì˜ëª»ëœ ì¼ì • ë°ì´í„° ê°ì§€:", event);
                                return null; // ì˜ëª»ëœ ë°ì´í„°ëŠ” ê±´ë„ˆë›°ê¸°
                            }

                            let color;
                            switch (event.scheduleDivision) {
                                case "ê°œì¸":
                                    color = "#28a745"; // ì´ˆë¡
                                    break;
                                case "ë¶€ì„œ":
                                    color = "#007bff"; // íŒŒë‘
                                    break;
                                case "íšŒì‚¬":
                                    color = "#ffc107"; // ë…¸ë‘
                                    break;
                            }

                            return {
                                id: event.scheduleId,
                                title: event.scheduleTitle,
                                start: event.scheduleStart,
                                end: event.scheduleEnd,
                                color: color, // ì—¬ê¸°ì—ì„œ ìƒ‰ìƒ ì ìš©
                                extendedProps: { 
                                    content: event.scheduleContent,
                                    employeeName: event.employeeName,
                                    departmentName: event.departmentName,
                                    scheduleDivision: event.scheduleDivision
                                },
                                allDay: false // allDay ì„¤ì • (true, false)
                            };
                        }).filter(event => event !== null); // null ì œê±°

                        successCallback(events);
                    })
                    .catch(error => {
                        console.error("ì¼ì • ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
                        failureCallback(error);
                    });
            },


            // Google Calendar ê³µíœ´ì¼
            eventSources: [
                {
                    googleCalendarId: 'ko.south_korea#holiday@group.v.calendar.google.com',
                    googleCalendarApiKey: 'AIzaSyAlyPfIm5gLdFAyx4r-kNVdsZDuGnnJMRk',
                    className: 'gcal-event'
                }
            ],
            // ì´ë²¤íŠ¸ í´ë¦­ ì‹œ ìƒì„¸ ë³´ê¸°
            // ì´ë²¤íŠ¸ í´ë¦­ ì‹œ ìƒì„¸ ë³´ê¸°
eventClick: function (info) {
    let event = info.event;
	console.log(event);
    // ëª¨ë‹¬ ìš”ì†Œ ê°€ì ¸ì˜¤ê¸°
    let modal = document.getElementById('scheduleInfoModal');
    
    // ì¼ì • ì œëª© ì„¤ì •
    modal.querySelector('.modal-title').innerText = event.title;
    
    // ì¼ì • ë‚´ìš© ì„¤ì •
    modal.querySelector('.modal-body').innerHTML = `
        <input type="hidden" id="editScheduleId" value="${event.id}">
        <div class="form-group">
        	<label>ë¶€ì„œëª…</label>
        	<input type="text" id="editDepartmentName" class="form-control" value="${event.extendedProps.departmentName || ''}" readonly>
    	</div>
        <div class="form-group">
            <label>ì‚¬ì› ì´ë¦„</label>
            <input type="text" id="editEmployeeName" class="form-control" value="${event.extendedProps.employeeName || ''}" readonly>
        </div>
        <div class="form-group">
            <label>ì¼ì • ì œëª©</label>
            <input type="text" id="editScheduleTitle" class="form-control" value="${event.title}">
        </div>
        <div class="form-group">
            <label>ì¼ì • ë‚´ìš©</label>
            <textarea id="editScheduleContent" class="form-control" rows="3">${event.extendedProps.content || ''}</textarea>
        </div>
        <div class="form-group">
            <label>ì‹œì‘ì¼ì‹œ</label>
            <input type="datetime-local" id="editScheduleStart" class="form-control" value="${convertToLocalDateTime(event.start)}">
        </div>
        <div class="form-group">
            <label>ì¢…ë£Œì¼ì‹œ</label>
            <input type="datetime-local" id="editScheduleEnd" class="form-control" value="${convertToLocalDateTime(event.end)}">
        </div>
    `;
	
    // ëª¨ë‹¬ í‘œì‹œ
    modal.style.display = 'block';
},

            // ê³µíœ´ì¼ ì´ë²¤íŠ¸ ìˆ˜ì • (ë°°ê²½ ì—†ì• ê³  í…ìŠ¤íŠ¸ë§Œ ë‚¨ê¸°ê¸° + "ì‰¬ëŠ” ë‚ " â†’ "ëŒ€ì²´ íœ´ë¬´"ë¡œ ë³€ê²½)
            eventDidMount: function(info) {
                let eventEl = info.el;

                // FullCalendar ê¸°ë³¸ ìŠ¤íƒ€ì¼ ì œê±°
                //eventEl.style.background = 'none';
                //eventEl.style.border = 'none';
                //eventEl.style.padding = '0';
                //eventEl.style.margin = '0';
                //eventEl.style.textAlign = 'left';
                //eventEl.style.pointerEvents = 'none'; // í´ë¦­ ë°©ì§€

                // ì´ë²¤íŠ¸ ì œëª© ë³€ê²½ (ì‰¬ëŠ” ë‚  â†’ ëŒ€ì²´ íœ´ë¬´)
                if (info.event.title.includes("ì‰¬ëŠ” ë‚ ")) {
                    info.event.setProp("title", info.event.title.replace("ì‰¬ëŠ” ë‚ ", "ëŒ€ì²´ íœ´ë¬´"));
                }
                
                // ì´ë²¤íŠ¸ ë‚´ë¶€ í…ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ ì ìš©
                let eventText = eventEl.querySelector('.fc-event-main');
                if (eventText) {
                    eventText.style.color = 'black';
                    eventText.style.fontSize = '12px';
                    eventText.style.fontWeight = 'bold';
                }
            }
        });

        // ìº˜ë¦°ë” ëœë”ë§
        calendar.render();

        // ì¼ì • ì¶”ê°€ ë²„íŠ¼ í´ë¦­ ì‹œ ì¼ì • ì¶”ê°€ ëª¨ë‹¬ í‘œì‹œ
        document.getElementById('addScheduleBtn').addEventListener('click', function () {
            document.getElementById('scheduleModal').style.display = 'block';
            const selectedType = document.querySelector('input[name="scheduleType"]:checked').value;
            if (selectedType === 'ê°œì¸') {
              $('#shareTargetGroup').show();
            } else {
              $('#shareTargetGroup').hide();
            }
        });

        // ì¼ì • ë“±ë¡ ëª¨ë‹¬ ë‹«ê¸° ë²„íŠ¼
        document.querySelector('.close').addEventListener('click', function () {
            document.getElementById('scheduleModal').style.display = 'none';        
        });
        
        // ì¼ì • ë“±ë¡ ëª¨ë‹¬ ë‹«ê¸° ë²„íŠ¼2
        document.querySelector('.close2').addEventListener('click', function(){
        	document.getElementById('scheduleModal').style.display = 'none';
        });
        
        // ëª¨ë‹¬ ë‹«ê¸° ë²„íŠ¼
        document.querySelector('.closeModal').addEventListener('click', function(){
        	document.getElementById('scheduleInfoModal').style.display = 'none';
        });
        
        document.querySelector('.closeModal2').addEventListener('click', function(){
        	document.getElementById('scheduleInfoModal').style.display = 'none';
        });
        
    });

    // ì¼ì • ì €ì¥ 
    function saveSchedule() {
    	let selectedType = document.querySelector('input[name="scheduleType"]:checked').value;
    	let sharedNos = document.getElementById("sharedEmployeeNos").value.trim();
    	let sharedList = sharedNos ? sharedNos.split(',').map(n => parseInt(n.trim())) : [];
    	
        let scheduleData = {
            scheduleTitle: document.getElementById("scheduleTitle").value,
            scheduleContent: document.getElementById("scheduleContent").value,
            scheduleStart: document.getElementById("scheduleStart").value,
            scheduleEnd: document.getElementById("scheduleEnd").value,
            scheduleDivision: selectedType,
            sharedEmployees: sharedList
        };

        fetch(url, {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(scheduleData)
        })
        .then(response => response.json())  // ì‘ë‹µì„ JSONìœ¼ë¡œ ë³€í™˜
        .then(data => {
            if (data.success === 1) {
                alert(data.message);  // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
                location.reload();
                document.getElementById('scheduleModal').style.display = 'none'; // ëª¨ë‹¬ ë‹«ê¸°
            } else {
                alert("ì¼ì • ë“±ë¡ ì‹¤íŒ¨.");
            }
        })
        .catch(error => {
            console.error("ì¼ì • ë“±ë¡ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
            alert("ì¼ì • ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
        });
    }
    
    function convertToLocalDateTime(date) {
        if (!date) return '';

        let d = new Date(date);
        let year = d.getFullYear();
        let month = String(d.getMonth() + 1).padStart(2, '0');
        let day = String(d.getDate()).padStart(2, '0');
        let hours = String(d.getHours()).padStart(2, '0');
        let minutes = String(d.getMinutes()).padStart(2, '0');

        return `${year}-${month}-${day}T${hours}:${minutes}`;
    }
    
 // ì¼ì • ìˆ˜ì •
    function updateSchedule() {
        let scheduleId = document.getElementById("editScheduleId").value;
        let scheduleData = {
            scheduleId: scheduleId,
            scheduleTitle: document.getElementById("editScheduleTitle").value,
            scheduleContent: document.getElementById("editScheduleContent").value,
            scheduleStart: document.getElementById("editScheduleStart").value,
            scheduleEnd: document.getElementById("editScheduleEnd").value
        };

        fetch(url, {
            method: "PUT",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(scheduleData)
        })
        .then(response => response.text())
        .then(data => {
            alert(data);  // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
            location.reload(); // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
        })
        .catch(error => {
            console.error("ì¼ì • ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
            alert("ì¼ì • ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
        });
    }

    // ì¼ì • ì‚­ì œ
    function deleteSchedule() {
        let scheduleId = document.getElementById("editScheduleId").value;

        fetch(`${url}/${scheduleId}`, {
            method: "DELETE",
            headers: {
                "Content-Type": "application/json"
            }
        })
        .then(response => response.text())
        .then(data => {
            alert(data);
            location.reload(); // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
        })
        .catch(error => {
            console.error("ì¼ì • ì‚­ì œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
            alert("ì¼ì • ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
        });
    }
 
// ì¼ì • ìœ í˜• ë³€ê²½ ì‹œ ê³µìœ ì ì„ íƒ ì˜ì—­ í† ê¸€
document.querySelectorAll('input[name="scheduleType"]').forEach(input => {
  input.addEventListener('change', function () {
    const shareTargetGroup = document.getElementById('shareTargetGroup');
    const selectedShareList = document.getElementById('selectedShareList');
    const sharedEmployeeNos = document.getElementById('sharedEmployeeNos');

    if (this.value === 'ê°œì¸') {
      shareTargetGroup.style.display = 'block';
    } else {
      shareTargetGroup.style.display = 'none';
      selectedShareList.innerHTML = '';
      sharedEmployeeNos.value = '';
    }
  });
});

// ê³µìœ ì ì„ íƒ ë²„íŠ¼ í´ë¦­ ì‹œ ëª¨ë‹¬ ì—´ê¸° + ì¡°ì§ë„ fetch
document.querySelector('[data-target="#shareModal"]').addEventListener('click', function () {
  fetch('/api/orgchart')
    .then(res => res.json())
    .then(data => buildTree(data, 'orgTreeShare'));

  const modal = document.getElementById('shareModal');
  modal.classList.add('show');
  modal.style.display = 'block';
  document.body.classList.add('modal-open');

  const backdrop = document.createElement('div');
  backdrop.className = 'modal-backdrop fade show';
  backdrop.setAttribute('id', 'shareBackdrop');
  document.body.appendChild(backdrop);
});

// ê³µìœ ì ëª¨ë‹¬ ë‹«ê¸°
document.querySelector('#shareModal .btn-secondary').addEventListener('click', function () {
  const modal = document.getElementById('shareModal');
  modal.classList.remove('show');
  modal.style.display = 'none';
  document.body.classList.remove('modal-open');

  const backdrop = document.getElementById('shareBackdrop');
  if (backdrop) backdrop.remove();
});

// âœ… ê³µìœ ì ì¶”ê°€
document.getElementById('addSharesBtn').addEventListener('click', function () {
  const checked = document.querySelectorAll('#orgTreeShare input.emp-check:checked');
  const names = [];
  const nos = [];

  checked.forEach(item => {
    names.push(item.dataset.name);
    nos.push(item.value);
  });

  // ë¦¬ìŠ¤íŠ¸ ì¶œë ¥
  const listEl = document.getElementById('selectedShareList');
  listEl.innerHTML = '';
  names.forEach(name => {
    const li = document.createElement('li');
    li.classList.add('list-group-item');
    li.textContent = name;
    listEl.appendChild(li);
  });

  // hidden ê°’ ì„¤ì •
  document.getElementById('sharedEmployeeNos').value = nos.join(',');

  // ëª¨ë‹¬ ë‹«ê¸°
  const modal = document.getElementById('shareModal');
  modal.classList.remove('show');
  modal.style.display = 'none';
  document.body.classList.remove('modal-open');

  const backdrop = document.getElementById('shareBackdrop');
  if (backdrop) backdrop.remove();
});

// âœ… ì¡°ì§ë„ íŠ¸ë¦¬ ë¹Œë“œ í•¨ìˆ˜
function buildTree(data, treeId) {
  const tree = document.getElementById(treeId);
  tree.innerHTML = '';

  const deptMap = {}, childDeptMap = {};
  data.forEach(dept => {
    if (!deptMap[dept.departmentNo]) deptMap[dept.departmentNo] = dept;
    if (!childDeptMap[dept.upperDepNo]) childDeptMap[dept.upperDepNo] = [];
    childDeptMap[dept.upperDepNo].push(dept);
  });

  const topDepts = childDeptMap[null] || childDeptMap[0] || [];
  topDepts.forEach(dept => {
    const deptLi = createDeptNodeRecursive(dept, childDeptMap);
    tree.appendChild(deptLi);
  });
}

function createDeptNodeRecursive(dept, childDeptMap) {
  const deptLi = document.createElement('li');
  deptLi.innerHTML = `
    <span class="toggle-icon">â–¶</span> ğŸ“ <strong>${dept.departmentName} (${dept.employees.length}ëª…)</strong>
  `;
  const subTree = document.createElement('ul');
  subTree.style.display = 'none';

  dept.employees.forEach(emp => {
    const empLi = document.createElement('li');
    empLi.innerHTML = `
      <input type="checkbox" class="emp-check" value="${emp.employeeNo}" data-name="${emp.employeeName}" data-job="${emp.jobTitleName}">
      ğŸ™â€â™‚ï¸ ${emp.employeeName} (${emp.jobTitleName})
    `;
    subTree.appendChild(empLi);
  });

  const children = childDeptMap[dept.departmentNo] || [];
  children.forEach(child => {
    const subDeptLi = createDeptNodeRecursive(child, childDeptMap);
    subTree.appendChild(subDeptLi);
  });

  deptLi.querySelector('.toggle-icon').addEventListener('click', function () {
    subTree.style.display = subTree.style.display === 'none' ? 'block' : 'none';
    this.textContent = subTree.style.display === 'none' ? 'â–¶' : 'â–¼';
  });

  deptLi.appendChild(subTree);
  return deptLi;
}


</script>

</body>
</html>
