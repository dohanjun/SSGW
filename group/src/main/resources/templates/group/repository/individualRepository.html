<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{common/layouts/default_layout}"
	layout:fragment="content">

<head>
<link
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
	rel="stylesheet">
<meta charset="UTF-8">
<title>ê°œì¸ ìë£Œì‹¤</title>
</head>
<body>

	<div class="card shadow mb-4">
		<div class="card-header py-3">
			<h6 class="m-0 font-weight-bold text-primary"
				th:text="${repository.fileRepositoryType}+' '+ìë£Œì‹¤"></h6>
		</div>
		<div class="card-body">

			<!-- ğŸ” ê²€ìƒ‰ form (GET) -->
			<div class="position-relative" style="width: 350px; margin: 0 auto;">
				<form th:action="@{/individualRepository}" method="get"
					class="position-relative mb-3" style="width: 300px;">
					<input type="text" name="keyword" class="form-control pl-4"
						placeholder="   ê²€ìƒ‰ì–´ ì…ë ¥" th:value="${keyword}">
					<button type="submit"
						style="position: absolute; top: 50%; left: 3px; transform: translateY(-50%); background: none; border: none;">
						<i class="fas fa-search" style="color: #aaa;"></i>
					</button>
				</form>
			</div>

			<!-- ê²Œì‹œê¸€ ë¦¬ìŠ¤íŠ¸ + íœ´ì§€í†µ form (POST) -->
			<form id="moveForm" th:action="@{/basket/moveToBasket}" method="post">
				<input type="hidden" name="repositoryType" value="ê°œì¸" />

				<div class="text-right mb-3">
					<a class="btn btn-primary"
						href='/repositoryInsert?repositoryType=ê°œì¸'>ë™ë¥µ</a>
				</div>

				<table class="table table-bordered" id="dataTable" width="100%"
					cellspacing="0">
					<thead>
						<tr>
							<th style= "text-align: center; width: 60px;"><input type="checkbox" id="selectAll"></th>
							<th style="text-align: center; width: 400px;">ì œëª©</th>
							<th style="text-align: center;">ì²¨ë¶€íŒŒì¼</th>
							<th style="text-align: center; width: 200px;">ì‘ì„±ì</th>
							<th style="text-align: center; width: 200px;">ì‘ì„±ì¼</th>
						</tr>
					</thead>
					<tbody>
						<tr th:if="${#lists.isEmpty(individualRepositoryList)}">
							<td colspan="5" class="text-center text-muted">ë“±ë¡ëœ ìë£Œê°€ ì—†ìŠµë‹ˆë‹¤.</td>
						</tr>

						<tr th:each="post : ${individualRepositoryList}"
							th:data-url="@{'/detailPost/' + ${post.writingId}}"
							onclick="location.href=this.dataset.url" style="cursor: pointer;">
							<td style= "text-align: center;"><input type="checkbox" name="writingIds"
								th:value="${post.writingId}"
								th:disabled="${post.employeeNo != loggedInEmpNo}"
								class="file-checkbox" onclick="event.stopPropagation()" /></td>
							<td th:text="${post.title}"></td>
							<td
								th:text="${post.fileCount > 1 ? post.fileName + ' ì™¸ ' + (post.fileCount - 1) + 'ê±´' : post.fileName}"></td>
							<td style="text-align: center;" th:text="${post.writer}"></td>
							<td style="text-align: center;" th:text="${#dates.format(post.creationDate, 'yyyy-MM-dd')}"></td>
						</tr>
					</tbody>
				</table>

				<div class="d-flex align-items-center justify-content-between mt-3">
					<div>
						<button type="submit" class="btn btn-danger">
							<i class="fas fa-trash"></i>
						</button>
					</div>

					<div class="flex-grow-1 d-flex justify-content-center">
						<nav aria-label="í˜ì´ì§€ë„¤ì´ì…˜">
							<ul class="pagination mb-0">
								<li class="page-item" th:classappend="${page == 1} ? 'disabled'">
									<a class="page-link"
									th:href="@{/individualRepository(page=${page - 1}, keyword=${keyword})}">&laquo;</a>
								</li>
								<li class="page-item"
									th:each="i : ${#numbers.sequence(1, totalPages)}"
									th:classappend="${i == page} ? 'active'"><a
									class="page-link"
									th:href="@{/individualRepository(page=${i}, keyword=${keyword})}"
									th:text="${i}"></a></li>
								<li class="page-item"
									th:classappend="${page == totalPages} ? 'disabled'"><a
									class="page-link"
									th:href="@{/individualRepository(page=${page + 1}, keyword=${keyword})}">&raquo;</a>
								</li>
							</ul>
						</nav>
					</div>
				</div>
			</form>
		</div>
	</div>

	<!-- âœ… ìŠ¤í¬ë¦½íŠ¸ -->
	<script>
	document.getElementById('selectAll').addEventListener('change', function () {
		const checkboxes = document.querySelectorAll('input[name="writingIds"]:not(:disabled)');
		checkboxes.forEach(cb => cb.checked = this.checked);
	});

	document.getElementById('moveForm').addEventListener('submit', function (e) {
		const checked = document.querySelectorAll('input[name="writingIds"]:checked');
		if (checked.length === 0) {
			alert('ì„ íƒëœ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.');
			e.preventDefault();
		}
	});
</script>
</body>
</html>
