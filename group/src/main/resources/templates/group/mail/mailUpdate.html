<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{common/layouts/default_layout}"
      layout:fragment="content">

<head>
    <meta charset="UTF-8">
    <title>메일 수정</title>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy" crossorigin="anonymous"></script>
</head>

<style>
    #flo{
        float: left;
        display: flex;
        justify-content: center;
    }
    .content-wrapper {
        display: flex;
        justify-content: center;
        align-items: center;
        height: calc(100vh - 100px);
        width: 100%;
        padding: 20px;
        box-sizing: border-box;
    }
    
    .employee-container {
        width: 600px;
        height: 600px;
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
        text-align: center;
    }
    
    #center{
        width: 100%;
        height: 100%;
        padding: 6px;
        border: 1px solid #ccc;
        border-radius: 5px;
        background-color: #f8f9fa;
        font-size: 14px;
        margin-bottom: 15px;
        font-size: 20px;
    }
</style>

<!-- 메일 수정하기 페이지 -->
<body>
<div id="content-wrapper" class="d-flex flex-column">
    <div id="container-fluid px-0">
        <div class="card shadow mb-4">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">메일수정하기</h6>
            </div>

            <div class="card-body">
                <form id="mailUpdateForm" class="user">
                    <div class="btn-container">
                        <button type="submit" class="btn btn-primary">저장</button>
                        <button type="button" class="btn btn-primary" id="saveDraftBtn">임시저장</button>
                    </div>
                    <table class="table file-info-table">
                        <tbody>
                            <tr>
                                <td>받는사람</td>
                                <td><input name="employeeId" id="employeeId" th:value="${mail.employeeId}" required></td>
                            </tr>
                            <tr>
                                <td>참조</td>
                                <td><input name="cc" id="cc" th:value="${mail.cc}"></td>
                            </tr>
                            <tr>
                                <td>제목</td>
                                <td><input name="title" id="title" th:value="${mail.title}" required></td>
                            </tr>
                            <tr>
                                <td>파일첨부</td>
                                <td><input name="attachedFileName" id="attachedFileName" th:value="${mail.attachedFileName}"></td>
                            </tr>
                            <tr>
                                <td>내용</td>
                                <td><textarea id="content" name="content" rows="4" cols="50" th:text="${mail.content}"></textarea></td>
                            </tr>
                        </tbody>
                    </table>
                </form>        
            </div>
        </div>
    </div>
</div>

<script>
    document.getElementById("mailUpdateForm").addEventListener("submit", function(event) {
        event.preventDefault();  // 기본 폼 제출을 막음

        // 폼 데이터 수집
        const mailData = {
        	employeeId: document.getElementById("employeeId").value,
            cc: document.getElementById("cc").value,
            title: document.getElementById("title").value,
            attachedFileName: document.getElementById("attachedFileName").value,
            content: document.getElementById("content").value
        };

        // fetch API로 메일 수정 요청
        fetch('/mail/mailUpdate', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(mailData)
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === "success") {
                alert(data.message);  // 성공 메시지
                window.location.href = '/mail';  // 메일 목록 페이지로 리다이렉트
            } else {
                alert(data.message);  // 실패 메시지
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert("메일 수정 중 오류가 발생했습니다.");
        });
    });

    // 임시 저장 버튼 (예시: 단순히 콘솔 로그 출력)
    document.getElementById("saveDraftBtn").addEventListener("click", function() {
        alert("임시 저장 기능은 아직 구현되지 않았습니다.");
    });
</script>

</body>
</html>