<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{common/layouts/default_layout}"
      layout:fragment="content">

<head>
    <meta charset="UTF-8">
    <meta name="_csrf" th:content="${_csrf.token}" />
    <meta name="_csrf_header" th:content="${_csrf.headerName}" />
    <title> íœ´ê°€ìœ í˜• ê´€ë¦¬</title>

    <!-- Bootstrap CDN -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.6.2/css/bootstrap.min.css">

    <style>
        /* ì „ì²´ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .card-box {
            border: 1px solid #dee2e6;
            border-radius: 12px;
            background: #fff;
            padding: 30px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.06);
        }

        .card-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 25px;
            color: #2c3e50;
            text-align: center;
        }

        .section-box {
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            background-color: #fdfdfd;
            margin-bottom: 20px;
        }

        .table th, .table td {
            vertical-align: middle;
        }

        .btn-emoji {
            font-size: 14px;
            padding: 4px 10px;
        }
    </style>
</head>

<body>
<div class="container mt-4">

    <!--  ìˆ¨ê²¨ì§„ í¼: í˜ì´ì§• & ë³´ê¸° ê°œìˆ˜ -->
    <form name="frmSearch" th:action="@{/vacationList}" method="get">
        <input type="hidden" name="page" th:value="${currentPage}">
        <input type="hidden" name="size" th:value="${vacationVO.size}">
    </form>

    <div class="card-box">
        <div class="card-title">ğŸŒ´ íœ´ê°€ìœ í˜• ê´€ë¦¬</div>
        <div class="row">

            <!-- ğŸ‘ˆ ì™¼ìª½: íœ´ê°€ìœ í˜• ëª©ë¡ -->
            <div class="col-md-8">
                <div class="section-box">
                    <h5 class="text-center mb-3">ğŸ“‹ íœ´ê°€ìœ í˜• ëª©ë¡</h5>

                    <!-- ë³´ê¸° ê°œìˆ˜ ë³€ê²½ -->
                    <div class="form-inline justify-content-end mb-2">
                        <label class="mr-2"> ë³´ê¸°:</label>
                        <select class="form-control form-control-sm" onchange="changeSize(this.value)">
                            <option th:value="5" th:selected="${vacationVO.size == 5}">5ê°œ</option>
                            <option th:value="10" th:selected="${vacationVO.size == 10}">10ê°œ</option>
                            <option th:value="15" th:selected="${vacationVO.size == 15}">15ê°œ</option>
                            <option th:value="20" th:selected="${vacationVO.size == 20}">20ê°œ</option>
                        </select>
                    </div>

                    <!-- ëª©ë¡ í…Œì´ë¸” -->
                    <table class="table table-bordered text-center">
                        <thead class="thead-light">
                            <tr>
                                <th>ğŸ“ ì´ë¦„</th>
                                <th>ğŸ“… ì¼ìˆ˜</th>
                                <th>ğŸ“ ì¦ë¹™</th>
                                <th>ğŸ—‘</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="v : ${vacations}">
                                <td th:text="${v.vacationTypeName}"></td>
                                <td th:text="${v.vacationDate} + 'ì¼'"></td>
                                <td th:text="${v.requiredProofDocumentFile == 'Y' ? 'í•„ìš”' : 'ë¶ˆí•„ìš”'}"></td>
                                <td>
                                    <button type="button" class="btn btn-sm btn-outline-danger btn-emoji"
                                            th:onclick="'deleteVacation(' + ${v.vacationTypeId} + ')'"> ì‚­ì œ</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
                    <nav>
                        <ul class="pagination justify-content-center">
                            <li class="page-item" th:if="${currentPage > 1}">
                                <a class="page-link" href="javascript:void(0);" th:onclick="'gopage(' + (${currentPage} - 1) + ')'"> ì´ì „</a>
                            </li>
                            <li class="page-item" th:each="i : ${#numbers.sequence(1, totalPages)}"
                                th:classappend="${i == currentPage} ? 'active'">
                                <a class="page-link" href="javascript:void(0);" th:onclick="'gopage(' + ${i} + ')'" th:text="${i}"></a>
                            </li>
                            <li class="page-item" th:if="${currentPage < totalPages}">
                                <a class="page-link" href="javascript:void(0);" th:onclick="'gopage(' + (${currentPage} + 1) + ')'">ë‹¤ìŒ </a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>

            <!-- ğŸ‘‰ ì˜¤ë¥¸ìª½: íœ´ê°€ìœ í˜• ë“±ë¡ -->
            <div class="col-md-4">
                <div class="section-box">
                    <h5 class="text-center mb-3"> íœ´ê°€ìœ í˜• ë“±ë¡</h5>
                    <form th:action="@{/vacaInsert}" th:object="${vacationVO}" method="post" onsubmit="return confirmInsert()">
                        <input type="hidden" th:field="*{vacationTypeId}" />
                        <input type="hidden" th:field="*{suberNo}" />

                        <div class="form-group">
                            <label>ğŸ“ íœ´ê°€ ì´ë¦„</label>
                            <input type="text" class="form-control" th:field="*{vacationTypeName}" required>
                        </div>

                        <div class="form-group">
                            <label>ğŸ“… íœ´ê°€ ì¼ìˆ˜</label>
                            <input type="number" class="form-control" th:field="*{vacationDate}" min="1" required>
                        </div>

                        <div class="form-group form-check">
                            <input type="checkbox" class="form-check-input" th:field="*{requiredProofDocumentFile}" value="Y">
                            <label class="form-check-label"> ì¦ë¹™ ì„œë¥˜ í•„ìš”</label>
                        </div>

                        <div class="text-center">
                            <button type="submit" class="btn btn-success btn-block"> ë“±ë¡</button>
                            <button type="button" class="btn btn-secondary btn-block" th:onclick="|location.href='@{/vacaList}'|"> ë’¤ë¡œ</button>
                        </div>
                    </form>
                </div>
            </div>

        </div>
    </div>
</div>

<!--  ê¸°ëŠ¥ ìŠ¤í¬ë¦½íŠ¸ -->
<script th:inline="javascript">
    const csrfToken = document.querySelector('meta[name="_csrf"]').getAttribute('content');
    const csrfHeader = document.querySelector('meta[name="_csrf_header"]').getAttribute('content');

    function confirmInsert() {
        alert("âœ… ë“±ë¡ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
        return true;
    }

    function gopage(p) {
        const form = document.forms["frmSearch"];
        form.page.value = p;
        form.submit();
    }

    function changeSize(size) {
        const form = document.forms["frmSearch"];
        form.size.value = size;
        form.page.value = 1;
        form.submit();
    }

    function deleteVacation(vacationTypeId) {
        if (!confirm("ğŸ—‘ ì´ íœ´ê°€ ìœ í˜•ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

        fetch("/vacaDelete", {
            method: "POST",
            headers: {
                "Content-Type": "application/x-www-form-urlencoded",
                [csrfHeader]: csrfToken
            },
            body: "vacationTypeId=" + vacationTypeId
        })
        .then(res => res.text())
        .then(result => {
            if (result === "success") {
                alert("ğŸ§¹ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!");
                location.reload();
            } else {
                alert("âŒ ì‚­ì œ ì‹¤íŒ¨!");
            }
        })
        .catch(err => {
            alert("ğŸš¨ ì˜¤ë¥˜ ë°œìƒ!");
            console.error(err);
        });
    }
</script>

</body>
</html>
