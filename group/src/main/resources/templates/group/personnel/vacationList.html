<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{common/layouts/default_layout}"
      layout:fragment="content">

<head>
    <meta charset="UTF-8">
    <meta name="_csrf" th:content="${_csrf.token}" />
    <meta name="_csrf_header" th:content="${_csrf.headerName}" />
    <title> Ìú¥Í∞ÄÏú†Ìòï Í¥ÄÎ¶¨</title>

    <!-- Bootstrap CDN -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.6.2/css/bootstrap.min.css">

    <style>
        /* Ï†ÑÏ≤¥ Ïπ¥Îìú Ïä§ÌÉÄÏùº */
        .card-box {
            border: 1px solid #dee2e6;
            border-radius: 12px;
            background: #fff;
            padding: 30px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.06);
        }

        .card-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 25px;
            color: #2c3e50;
            text-align: center;
        }

        .section-box {
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            background-color: #fdfdfd;
            margin-bottom: 20px;
        }

        .table th, .table td {
            vertical-align: middle;
        }

        .btn-emoji {
            font-size: 14px;
            padding: 4px 10px;
        }
    </style>
</head>

<body>
<div class="container mt-4">

    <!--  Ïà®Í≤®ÏßÑ Ìèº: ÌéòÏù¥Ïßï & Î≥¥Í∏∞ Í∞úÏàò -->
    <form name="frmSearch" th:action="@{/vacationList}" method="get">
        <input type="hidden" name="page" th:value="${currentPage}">
        <input type="hidden" name="size" th:value="${vacationVO.size}">
    </form>

    <div class="card-box">
        <div class="card-title">üå¥ Ìú¥Í∞ÄÏú†Ìòï Í¥ÄÎ¶¨</div>
        <div class="row">

            <!-- ÏôºÏ™Ω: Ìú¥Í∞ÄÏú†Ìòï Î™©Î°ù -->
            <div class="col-md-8">
                <div class="section-box">
                    <h5 class="text-center mb-3">üìã Ìú¥Í∞ÄÏú†Ìòï Î™©Î°ù</h5>

                    <!-- Î≥¥Í∏∞ Í∞úÏàò Î≥ÄÍ≤Ω -->
                    <div class="form-inline justify-content-end mb-2">
                        <label class="mr-2"> Î≥¥Í∏∞:</label>
                        <select class="form-control form-control-sm" onchange="changeSize(this.value)">
                            <option th:value="5" th:selected="${vacationVO.size == 5}">5Í∞ú</option>
                            <option th:value="10" th:selected="${vacationVO.size == 10}">10Í∞ú</option>
                            <option th:value="15" th:selected="${vacationVO.size == 15}">15Í∞ú</option>
                            <option th:value="20" th:selected="${vacationVO.size == 20}">20Í∞ú</option>
                        </select>
                    </div>

                    <!-- Î™©Î°ù ÌÖåÏù¥Î∏î -->
                    <table class="table table-bordered text-center">
                        <thead class="thead-light">
                            <tr>
                                <th>üìù Ïù¥Î¶Ñ</th>
                                <th>üìÖ ÏùºÏàò</th>
                                <th>üìé Ï¶ùÎπô</th>
                                <th>üóë</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="v : ${vacations}">
                                <td th:text="${v.vacationTypeName}"></td>
                                <td th:text="${v.vacationDate} + 'Ïùº'"></td>
                                <td th:text="${v.requiredProofDocumentFile == 'Y' ? 'ÌïÑÏöî' : 'Î∂àÌïÑÏöî'}"></td>
                                <td>
                                    <button type="button" class="btn btn-sm btn-outline-danger btn-emoji"
                                            th:onclick="'deleteVacation(' + ${v.vacationTypeId} + ')'"> ÏÇ≠Ï†ú</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <!-- ÌéòÏù¥ÏßÄÎÑ§Ïù¥ÏÖò -->
                    <nav>
                        <ul class="pagination justify-content-center">
                            <li class="page-item" th:if="${currentPage > 1}">
                                <a class="page-link" href="javascript:void(0);" th:onclick="'gopage(' + (${currentPage} - 1) + ')'"> Ïù¥Ï†Ñ</a>
                            </li>
                            <li class="page-item" th:each="i : ${#numbers.sequence(1, totalPages)}"
                                th:classappend="${i == currentPage} ? 'active'">
                                <a class="page-link" href="javascript:void(0);" th:onclick="'gopage(' + ${i} + ')'" th:text="${i}"></a>
                            </li>
                            <li class="page-item" th:if="${currentPage < totalPages}">
                                <a class="page-link" href="javascript:void(0);" th:onclick="'gopage(' + (${currentPage} + 1) + ')'">Îã§Ïùå </a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>

            <!-- Ïò§Î•∏Ï™Ω: Ìú¥Í∞ÄÏú†Ìòï Îì±Î°ù -->
            <div class="col-md-4">
                <div class="section-box">
                    <h5 class="text-center mb-3"> Ìú¥Í∞ÄÏú†Ìòï Îì±Î°ù</h5>
                    <form th:action="@{/vacaInsert}" th:object="${vacationVO}" method="post" onsubmit="return confirmInsert()">
                        <input type="hidden" th:field="*{vacationTypeId}" />
                        <input type="hidden" th:field="*{suberNo}" />

                        <div class="form-group">
                            <label>üìù Ìú¥Í∞Ä Ïù¥Î¶Ñ</label>
                            <input type="text" class="form-control" th:field="*{vacationTypeName}" maxlength="9" required>
                        </div>

                        <div class="form-group">
                            <label>üìÖ Ìú¥Í∞Ä ÏùºÏàò</label>
                            <input type="number" class="form-control" th:field="*{vacationDate}" min="1" max="999" required>
                        </div>

                        <div class="form-group form-check">
                            <input type="checkbox" class="form-check-input" th:field="*{requiredProofDocumentFile}" value="Y">
                            <label class="form-check-label"> Ï¶ùÎπô ÏÑúÎ•ò ÌïÑÏöî</label>
                        </div>

                        <div class="text-center">
                            <button type="submit" class="btn btn-success btn-block"> Îì±Î°ù</button>
                            <button type="button" class="btn btn-secondary btn-block" th:onclick="|location.href='@{/vacaList}'|"> Îí§Î°ú</button>
                        </div>
                    </form>
                </div>
            </div>

        </div>
    </div>
</div>

<!--  Í∏∞Îä• Ïä§ÌÅ¨Î¶ΩÌä∏ -->
<script th:inline="javascript">
    // CSRF ÌÜ†ÌÅ∞ Í∞ÄÏ†∏Ïò§Í∏∞
    const csrfToken = document.querySelector('meta[name="_csrf"]').getAttribute('content');
    const csrfHeader = document.querySelector('meta[name="_csrf_header"]').getAttribute('content');

    // Îì±Î°ù Ïãú Ïú†Ìö®ÏÑ± Í≤ÄÏÇ¨ Î∞è Îì±Î°ù ÌôïÏù∏ ÏïåÎ¶º
    function confirmInsert() {
        const name = document.querySelector('[name="vacationTypeName"]').value;
        const date = document.querySelector('[name="vacationDate"]').value;

        if (name.length > 9) {
            alert("Ìú¥Í∞Ä Ïù¥Î¶ÑÏùÄ ÏµúÎåÄ 9ÏûêÍπåÏßÄ ÏûÖÎ†• Í∞ÄÎä•Ìï©ÎãàÎã§.");
            return false;
        }
        if (parseInt(date) > 999) {
            alert("Ìú¥Í∞Ä ÏùºÏàòÎäî ÏµúÎåÄ 999ÏùºÍπåÏßÄ Í∞ÄÎä•Ìï©ÎãàÎã§.");
            return false;
        }

        alert("‚úÖ Îì±Î°ùÏù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§.");
        return true;
    }

    // ÌéòÏù¥ÏßÄ Ïù¥Îèô Ï≤òÎ¶¨
    function gopage(p) {
        const form = document.forms["frmSearch"];
        form.page.value = p;
        form.submit();
    }

    // Î≥¥Í∏∞ Í∞úÏàò Î≥ÄÍ≤Ω Ï≤òÎ¶¨
    function changeSize(size) {
        const form = document.forms["frmSearch"];
        form.size.value = size;
        form.page.value = 1;
        form.submit();
    }

    // Ìú¥Í∞Ä Ïú†Ìòï ÏÇ≠Ï†ú Ï≤òÎ¶¨
    function deleteVacation(vacationTypeId) {
        if (!confirm("üóë Ïù¥ Ìú¥Í∞Ä Ïú†ÌòïÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?")) return;

        fetch("/vacaDelete", {
            method: "POST",
            headers: {
                "Content-Type": "application/x-www-form-urlencoded",
                [csrfHeader]: csrfToken // CSRF Î≥¥Ïïà ÌÜ†ÌÅ∞ Ìè¨Ìï®
            },
            body: "vacationTypeId=" + vacationTypeId
        })
        .then(res => res.text())
        .then(result => {
            if (result === "success") {
                alert("üßπ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§!");
                location.reload();
            } else {
                alert("‚ùå ÏÇ≠Ï†ú Ïã§Ìå®!");
            }
        })
        .catch(err => {
            alert("üö® Ïò§Î•ò Î∞úÏÉù!");
            console.error(err);
        });
    }

    // Ïã§ÏãúÍ∞Ñ ÏûÖÎ†• Ï†úÌïú (Ìú¥Í∞Ä Ïù¥Î¶Ñ: 9Ïûê, Ìú¥Í∞Ä ÏùºÏàò: ÏµúÎåÄ 999)
    document.addEventListener('DOMContentLoaded', function () {
        const nameInput = document.querySelector('[name="vacationTypeName"]');
        const dateInput = document.querySelector('[name="vacationDate"]');

        // Ìú¥Í∞Ä Ïù¥Î¶Ñ: 9Ïûê Ï¥àÍ≥º ÏûÖÎ†• Ïãú ÏûêÎèôÏúºÎ°ú ÏûòÎùºÎÉÑ
        nameInput.addEventListener('input', function () {
            if (this.value.length > 9) {
                this.value = this.value.slice(0, 9);
            }
        });

        // Ìú¥Í∞Ä ÏùºÏàò: 1 ~ 999 ÏÇ¨Ïù¥Î°úÎßå ÏûÖÎ†• Í∞ÄÎä•ÌïòÍ≤å Ï†úÌïú
        dateInput.addEventListener('input', function () {
            const value = parseInt(this.value);
            if (value > 999) {
                this.value = 999;
            } else if (value < 1 || isNaN(value)) {
                this.value = 1;
            }
        });
    });
</script>


</body>
</html>
